function t(t){return t&&t.__esModule?t.default:t}var s={};class e{static statuses={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.size=4,this.score=0,this.status=e.statuses.IDLE,this.initialState=t,this.state=t.map(t=>[...t])}start(){this.addRandomTile(),this.addRandomTile(),this.status=e.statuses.PLAYING}restart(){this.state=this.initialState.map(t=>[...t]),this.score=0,this.status=e.statuses.IDLE}addRandomTile(){let t=[];if(this.state.forEach((s,e)=>{s.forEach((s,i)=>{0===s&&t.push({row:e,col:i})})}),0===t.length)return;let s=Math.floor(Math.random()*t.length),{row:e,col:i}=t[s];this.state[e][i]=.9>Math.random()?2:4}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}updateScore(t){this.score=this.score+t}boardsAreEqual(t,s){for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)if(t[e][i]!==s[e][i])return!1;return!0}checkStatus(){let t=!1,s=!1;for(let i=0;i<4;i++)for(let a=0;a<4;a++){if(2048===this.state[i][a]){this.status=e.statuses.WIN;return}0===this.state[i][a]&&(s=!0),(i<3&&this.state[i][a]===this.state[i+1][a]||a<3&&this.state[i][a]===this.state[i][a+1])&&(t=!0)}t||s||(this.status=e.statuses.LOSE)}moveLeft(){if(this.status===e.statuses.PLAYING){let t=this.state.map(t=>[...t]),s=[],e=[];for(let t=0;t<this.size;t++){let e=this.state[t].filter(t=>0!==t);for(;e.length<this.size;)e.push(0);s.push(e)}for(let t=0;t<this.size;t++){let i=s[t].filter(t=>0!==t);for(let t=0;t<i.length;t++)i[t]===i[t+1]&&(i[t]*=2,i.splice(t+1,1),this.updateScore(i[t]));for(;i.length<this.size;)i.push(0);e.push(i)}this.boardsAreEqual(t,e)||(this.state=e,this.addRandomTile(),this.checkStatus())}}moveRight(){if(this.status===e.statuses.PLAYING){let t=this.state.map(t=>[...t]),s=[],e=[];for(let t=0;t<this.size;t++){let e=this.state[t].filter(t=>0!==t);for(;e.length<this.size;)e.unshift(0);s.push(e)}for(let t=0;t<this.size;t++){let i=s[t].filter(t=>0!==t);for(let t=i.length-1;t>0;t--)i[t]===i[t-1]&&(i[t]*=2,i.splice(t-1,1),i.unshift(0),this.updateScore(i[t]));for(;i.length<this.size;)i.unshift(0);e.push(i)}this.boardsAreEqual(t,e)||(this.state=e,this.addRandomTile(),this.checkStatus())}}moveUp(){if(this.status===e.statuses.PLAYING){let t=this.state.map(t=>[...t]);for(let t=0;t<this.size;t++){let s=[];for(let e=0;e<this.size;e++)0!==this.state[e][t]&&s.push(this.state[e][t]);for(;s.length<this.size;)s.push(0);for(let e=0;e<this.size;e++)this.state[e][t]=s[e]}for(let t=0;t<this.size;t++){let s=[],e=0;for(;e<this.size;)e<this.size-1&&this.state[e][t]===this.state[e+1][t]?(s.push(2*this.state[e][t]),this.updateScore(2*this.state[e][t]),e+=2):(s.push(this.state[e][t]),e++);for(;s.length<this.size;)s.push(0);for(let e=0;e<this.size;e++)this.state[e][t]=s[e]}this.boardsAreEqual(t,this.state)||(this.addRandomTile(),this.checkStatus())}}moveDown(){if(this.status===e.statuses.PLAYING){let t=this.state.map(t=>[...t]);for(let t=0;t<this.size;t++){let s=[];for(let e=0;e<this.size;e++)0!==this.state[e][t]&&s.push(this.state[e][t]);for(;s.length<this.size;)s.unshift(0);for(let e=0;e<this.size;e++)this.state[e][t]=s[e]}for(let t=0;t<this.size;t++){let s=[],e=this.size-1;for(;e>=0;)e>0&&this.state[e][t]===this.state[e-1][t]?(s.unshift(2*this.state[e][t]),this.updateScore(2*this.state[e][t]),e-=2):(s.unshift(this.state[e][t]),e--);for(;s.length<this.size;)s.unshift(0);for(let e=0;e<this.size;e++)this.state[e][t]=s[e]}this.boardsAreEqual(t,this.state)||(this.addRandomTile(),this.checkStatus())}}}const i=new(t(s=e));function a(){let t=document.querySelector(".game-field");t.innerHTML="",i.getState().forEach(s=>{let e=document.createElement("tr");e.classList.add("field-row"),s.forEach(t=>{let s=document.createElement("td");s.classList.add("field-cell"),t>0&&s.classList.add(`field-cell--${t}`),s.textContent=0!==t?t:"",e.appendChild(s)}),t.appendChild(e)})}function h(){u.innerHTML=i.getScore()}const r=document.querySelector(".button"),o=document.querySelector(".message-start"),l=document.querySelector(".message-lose"),n=document.querySelector(".message-win"),u=document.querySelector(".game-score");r.addEventListener("click",()=>{r.classList.contains("start")?(i.start(),a(),h(),r.classList.remove("start"),r.classList.add("restart"),r.textContent="Restart",o.classList.add("hidden")):r.classList.contains("restart")&&(r.classList.remove("restart"),r.classList.add("start"),r.textContent="Start",l.classList.add("hidden"),i.restart(),a(),h())}),document.addEventListener("keydown",e=>{switch(e.preventDefault(),e.key){case"ArrowUp":i.moveUp();break;case"ArrowDown":i.moveDown();break;case"ArrowRight":i.moveRight();break;case"ArrowLeft":i.moveLeft()}h(),a(),i.getStatus()===t(s).statuses.WIN?n.classList.remove("hidden"):i.getStatus()===t(s).statuses.LOSE&&l.classList.remove("hidden")});
//# sourceMappingURL=index.bbb75dfe.js.map
